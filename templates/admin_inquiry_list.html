<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ì „ì²´ ë¬¸ì˜ ëª©ë¡</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/form-style.css') }}" />
</head>
<body>

  <!-- ìƒë‹¨ ë„¤ë¹„ -->
  <div class="top-nav">
    <div class="nav-left">
      <div class="form-icon"><strong>ğŸ“„</strong></div>
      <div class="form-title-group">
        <div class="form-title-text">ì „ì²´ ë¬¸ì˜ ê´€ë¦¬</div>
      </div>
    </div>

    <div class="nav-center"></div>

    <div class="nav-right">
      <button class="publish-btn" onclick="location.href='/admin/store/search'">ë§¤ì¥ ê²€ìƒ‰</button>
      <div class="profile-icon">A</div>
    </div>
  </div>

  <div class="main-content">
    <div class="tab-menu">
      <button class="tab-btn" onclick="location.href='/admin/store/search'">ë§¤ì¥ ê²€ìƒ‰</button>
      <button class="tab-btn active">ë¬¸ì˜</button>
    </div>

    <div class="form-container">
      <div class="form-card">
        <p><strong>ì „ì²´ ë¬¸ì˜ ëª©ë¡</strong></p>

        <table class="styled-table" style="margin-top: 16px; width: 100%;">
          <thead>
            <tr>
              <th>ë²ˆí˜¸</th>
              <th>ì œëª©</th>
              <th>ì‘ì„±ì</th>
              <th>ë¶„ì•¼</th>
              <th>ì‘ì„±ì¼</th>
              <th>ë‹µë³€</th>
            </tr>
          </thead>
          <tbody id="inquiry-table-body">
            <!-- JSê°€ ì—¬ê¸°ë‹¤ê°€ í–‰ ì¶”ê°€í•¨ -->
          </tbody>
        </table>

        <div id="msg" style="margin-top: 12px; color: #5f6368;"></div>
      </div>
    </div>
  </div>

<script>
async function loadInquiries() {
  const API = "http://localhost:5000/api/inquiries_all";

  try {
    const res = await fetch(API);
    const data = await res.json();

    if (!Array.isArray(data)) {
      msg.textContent = "ëª©ë¡ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.";
      return;
    }

    const tbody = document.getElementById("inquiry-table-body");
    tbody.innerHTML = "";

    data.forEach(row => {
      const tr = document.createElement("tr");

      tr.innerHTML = `
        <td>${row.inquiry_id}</td>
        <td style="cursor:pointer; color:#1a73e8;"
            onclick="location.href='/admin_inquiry_detail?id=${row.inquiry_id}'">
            ${row.title}
        </td>
        <td>${row.writer}</td>
        <td>${row.field || "-"}</td>
        <td>${row.created_at}</td>
        <td>${row.answer ? "ì™„ë£Œ" : "ëŒ€ê¸°"}</td>
      `;

      tbody.appendChild(tr);
    });

  } catch (err) {
    console.error(err);
    document.getElementById("msg").textContent = "ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.";
  }
}

// í˜ì´ì§€ ë¡œë“œì‹œ ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸°
loadInquiries();

// ë¡œê·¸ì•„ì›ƒ ê¸°ëŠ¥
function logout() {
  if (confirm("ë¡œê·¸ì•„ì›ƒ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
    // localStorageì—ì„œ ëª¨ë“  ì¸ì¦ ì •ë³´ ì œê±°
    localStorage.removeItem("token");
    localStorage.removeItem("user_id");
    localStorage.removeItem("user_name");
    localStorage.removeItem("isAdmin");
    localStorage.removeItem("adminId");
    localStorage.removeItem("admin_name");
    localStorage.removeItem("adminName");
    
    // ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™
    window.location.href = "/login";
  }
}

// í”„ë¡œí•„ ì•„ì´ì½˜ í´ë¦­ ì‹œ ë¡œê·¸ì•„ì›ƒ
document.querySelector(".profile-icon").addEventListener("click", logout);
</script>

</body>
</html>
